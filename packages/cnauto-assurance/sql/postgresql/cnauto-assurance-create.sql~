-- /package/cnauto-assurance/sql/postgresql/cnauto-assurance-create.sql

--
-- The CN Auto Assurance Package
--
-- @author Iuri Sampaio (iuri.sampaio@iurix.com)
-- @creation-date 2011-11-24
--



------------------------------------
-- Object Type: cn_vehicles
------------------------------------

SELECT acs_object_type__create_type (
    'cn_vehicle',	    -- object_type
    'CN Vehicle',           -- pretty_name
    'CN Vehicles',    	    -- pretty_plural
    'acs_object',     	    -- supertype
    'cn_vehicles',          -- table_name
    'vehicle_id',     	    -- id_column
    'vehicle.name',	    -- name_method
    'f',
    null,
    null
);


------------------------------------
-- Table cn_vehicles
------------------------------------

-- vin (vehicle identification number) - chassi
CREATE TABLE cn_vehicles (
       vehicle_id		INTEGER PRIMARY KEY
       				CONSTRAINT cn_vehicles_vehicle_id_fk
				REFERENCES acs_objects ON DELETE CASCADE,
       vin			VARCHAR(50)
       				CONSTRAINT cn_vehicles_vin_nn NOT NULL
				CONSTRAINT cn_vehicles_vin_un UNIQUE,
       engine		VARCHAR(100
       model
       year_of_model		
       year_of_fabrication 
       color			integer
       				CONSTRAINT cn_vehicles_color_fk
				REFERENCES cn_colors,	   
       
);



CREATE TABLE cn_colors (
       code      varchar(10)
       		 CONSTRAINT cn_colors_code_nn NOT NULL
       		 CONSTRAINT cn_colors_code_un UNIQUE,       
       name	 varchar(50)
);


------------------------------------
-- Table cn_assurances
------------------------------------

CREATE TABLE cn_assurances (
       assurance_id	   integer PRIMARY KEY
       			   CONSTRAINT cn_assurances_assurance_id_fk
			   REFERENCES acs_objects ON DELETE CASCADE,
       vin		   varchar(50)
       			   CONSTRAINT cn_assurances_vin_fk
			   REFERENCES cn_vehicles,
       purchase_date	   timestamp,
       durantion	   varchar(10),
       owner		   varchar(255),
       distributor	   varchar(10),
       notes		   text,
       postal_address 	   varchar(255),
       postal_address2 	   varchar(255),
       postal_code 	   varchar(50),
       state_abbrev 	   varchar(2)
       		    	   CONSTRAINT lm_lead_contacts_state_abbrev_fk
 		           REFERENCES br_states (abbrev),
       municipality varchar(100),
       country_code varchar(2)
       		    	   CONSTRAINT lm_lead_contacts_country_code_fk
			   REFERENCES countries (iso),
       phone		   varchar(15)
);