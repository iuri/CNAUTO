ad_page_contract {
    Shows person's info
} {
    {person_id:integer,optional}
    {return_url ""}
}

set page_title [_ cnauto-assurance.Person_info]

ns_log Notice "$return_url"

ad_form -name person_one -action person-ae -export {return_url person_id} -has_submit 1 -has_edit 1 -mode display -form {
    {inform1:text(inform)
        {label "<h2>[_ cnauto-assurance.Vehicle_info]</h2>"}
        {value ""}
    }
    {cpf_cnpj:text(text)
	{label "[_ cnauto-asssurance.CPF_CNPJ]"}
    }
    {pretty_name:text(text)
	{label "[_ cnauto-asssurance.Name]"}
    }
    {legal_name:text(text)
	{label "[_ cnauto-assurance.Legal_name]"}
    }	
    {type:text(text)
	{label "[_ cnauto-assurance.Type]"}
    }
    {email:text(text)
	{label "[_ cnauto-assurance.Email]"}
    } 
    {postal_address:text(text)
	{label "[_ cnauto-assurance.Postal_address]"}
    } 
    {postal_address2:text(text)
	{label "[_ cnauto-assurance.Postal_address]"}
    } 
    {postal_code:text(text)
	{label "[_ cnauto-assurance.Postal_code]"}
    } 
    {state:text(text)
	{label "[_ cnauto-assurance.State]"}
    } 
    {municipality:text(text)
	{label "[_ cnauto-assurance.Municipality]"}
    } 
    {country:text(text)
	{label "[_ cnauto-assurance.Country]"}
    } 
    {phone:text(text)
	{label "[_ cnauto-assurance.Phone]"}
    } 
} -on_request {
    
   
    db_1row select_person_info {

	SELECT DISTINCT cp.cpf_cnpj, cp.legal_name, cp.pretty_name, cp.type_id, cc.pretty_name AS type, cp.email, postal_address, cp.postal_address2, cp.postal_code, cp.state_code AS state, bim.name AS municipality, cp,country_code AS country, cp.phone 
	FROM cn_persons cp, cn_categories cc, br_ibge_municipality bim 
	WHERE cp.person_id = :person_id
	AND cp.type_id = cc.category_id
	AND cp.city_code = bim.ibge_code
    }


    set person_ae_url [export_vars -base "person-ae" {person_id {type_id $type_id} return_url}]

} -on_submit {

    set myform [ns_getform]
    if {[string equal "" $myform]} {
	ns_log Notice "No Form was submited"
    } else {
	ns_log Notice "FORM"
	ns_set print $myform
    }
}




