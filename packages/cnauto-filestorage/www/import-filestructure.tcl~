ad_page_contract {
    Imports file structure from filesystem
} {
    {return_url ""}
}


set root_dir [parameter::get -parameter FileStorageRootDir -package_id [ad_conn package_id] -default ""]




namespace eval cn_filestorage {}

ad_proc -public browse_folders {
    {-root_dir:required}
} {
    browse folders, subfolders and files in the file system
} {

    if {$root_dir ne ""} {
	if {[file isdirectory $root_dir]} {
 	    set items [glob ${root_dir}/*]
	    
	    foreach item $items {
		if {[file isdirectory $item]} {
		    ns_log notice "FOLDER $item"
		    browse_folders -root_dir $item
		}
	    } 
	} elseif {[file isfile $item]} {
		ns_log notice "FILE $item"
	    
	} else {		
	
	    ns_log Notice "root Diretory does not exists!!!"
	}	
    }
}




 
    
browse_folders -root_dir $root_dir
    




ad_returnredirect $return_url
ad_script_abort